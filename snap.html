<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Take Snap</title>

  <link href="https://fonts.googleapis.com/css2?family=Baloo+2&family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1E3C72, #2A5298);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    header {
      font-family: 'Baloo 2', cursive;
      font-size: 2rem;
      color: #FFD93D;
      text-align: center;
      padding: 1rem;
      background: rgba(255,255,255,0.1);
      width: 100%;
    }
    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      gap: 1rem;
    }
    #video-container {
      position: relative;
      background: rgba(255,255,255,0.1);
      border-radius: 16px;
      overflow: hidden;
      width: 720px;
      height: 405px;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1);
    }
    #timer {
      position: absolute;
      top: 10px; right: 10px;
      background: rgba(255,255,255,0.9);
      color: #2A5298;
      padding: 0.4rem 0.8rem;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1.5rem;
      opacity: 0;
    }
    #photos {
      width: 90%;
      max-width: 720px;
      min-height: 150px;
      position: relative;
    }
    .photo-item {
      cursor: grab;
    }
    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    button {
      background: #FFD93D;
      color: #2A5298;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    footer { margin-top: 2rem; opacity: 0.8; }
  </style>
</head>

<body>
  <header>ðŸ“¸ abcSnap Booth â€” Business Week 2025</header>

  <main>
    <div id="video-container">
      <video id="video" autoplay playsinline></video>
      <div id="timer">3</div>
    </div>

    <!-- Photos go here -->
    <div id="photos"></div>

    <div id="controls">
      <button id="startBtn">Start Taking Photos</button>
      <button id="nextButton" disabled>Next âžœ</button>
    </div>
  </main>

  <footer>Â© 2025 abcSnap</footer>

  <!-- Sortable Photos plugin (your pasted code simplified) -->
  <script>
    (function($){
      $.widget('glekli.sortablePhotos', {
        options: {selector: '> *', sortable:true, padding:2},
        arrange:function(){
          var container=this.element, width=container.width(), pad=this.options.padding, x=0,y=0,rowH=0;
          container.find(this.options.selector).each(function(){
            var img=$(this).find('img')[0];
            if(!img.complete)return;
            var w=img.naturalWidth, h=img.naturalHeight, aspect=w/h;
            var targetH=150; var targetW=targetH*aspect;
            $(this).css({position:'absolute',top:y,left:x});
            $(this).find('img').css({width:targetW,height:targetH});
            x+=targetW+pad; rowH=Math.max(rowH,targetH);
            if(x+targetW>width){ x=0; y+=rowH+pad; rowH=0; }
          });
          container.height(y+rowH);
        },
        _create:function(){
          var self=this; this.arrange();
          $(window).on('resize',()=>self.arrange());
          if(this.options.sortable){
            this.element.children().draggable({containment:'parent',opacity:0.7});
            this.element.children().droppable({
              drop:function(e,ui){ $(ui.draggable).insertBefore(this); self.arrange(); }
            });
          }
        }
      });
    })(jQuery);
  </script>

  <script>
    const video=document.getElementById('video');
    const timer=document.getElementById('timer');
    const startBtn=document.getElementById('startBtn');
    const nextBtn=document.getElementById('nextButton');
    const photosDiv=$('#photos');
    let stream,photos=[];

    async function startCamera(){
      try{
        stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:false});
        video.srcObject=stream;
      }catch(err){alert('Camera error');}
    }

    function takePhoto(){
      const canvas=document.createElement('canvas');
      canvas.width=video.videoWidth; canvas.height=video.videoHeight;
      const ctx=canvas.getContext('2d');
      ctx.translate(canvas.width,0); ctx.scale(-1,1);
      ctx.drawImage(video,0,0,canvas.width,canvas.height);
      return canvas.toDataURL('image/jpeg',0.5); // compressed
    }

    async function countdown(s){
      timer.style.opacity='1';
      for(let i=s;i>0;i--){timer.textContent=i; await new Promise(r=>setTimeout(r,1000));}
      timer.style.opacity='0';
    }

    async function startCapture(){
      startBtn.disabled=true; nextBtn.disabled=true; photos=[];
      photosDiv.empty();
      for(let i=0;i<4;i++){
        await countdown(3);
        const data=takePhoto();
        photos.push(data);
        const item=$(`<div class="photo-item"><img src="${data}" alt="shot"/></div>`);
        photosDiv.append(item);
      }
      nextBtn.disabled=false;
      photosDiv.sortablePhotos();
    }

    startBtn.onclick=startCapture;

    nextBtn.onclick=()=>{
      try{
        sessionStorage.setItem('photoSet',JSON.stringify(photos));
        window.location.href='frames.html';
      }catch(e){alert('Save error: '+e.message);}
    };

    startCamera();
  </script>
</body>
</html>
